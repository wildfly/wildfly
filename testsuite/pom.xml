<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright The WildFly Authors
  ~ SPDX-License-Identifier: Apache-2.0
  -->


<!--
    1. The testsuite module has a number of child modules that provide test classes:

    integration      - holds all integration tests for standalone Wildfly servers.
    domain           - holds all domain management tests for Wildfly.
    galleon          - tests of manipulation of WildFly installations via the Galleon command line tool
    layers           - validation of Galleon layers that can be provisioned using the wildfly-ee feature pack
    layers-expansion - validation of Galleon layers that can be provisioned using the wildfly or wildfly-preview feature packs
    mixed-domain     - test domain mode management of previous-release secondary host controllers by a current version DC
    preview          - tests that are only applicable to WildFly Preview
    scripts          - tests execution of scripts shipped with the server

    All tests should fit into one of these child modules.

    2. This pom is inherited by all child modules that provide tests and should be used to do the following:
       - Set defaults for common testsuite system properties (which can then be overridden on the command line).
       - Define dependencies common to all tests (Arquillian, junit or testng, and container type).
       - Provide a workaround for @Resource(lookup=...) which requires libraries in jbossas/endorsed.
       - Define a default server configuration installed into target/wildfly in each submodule, which
         represents an unmodified copy of the AS server. Custom server configurations are defined in the submodules.

    3. This pom should not be used to do the following:
       - Define module-specific server configuration build steps.
       - Define module-specific surefire executions.
       These elements should be defined in logical profiles associated with each logical grouping of tests,
       in the pom for the module which contains the tests. See the submodule poms for more details.

   4. The testsuite directory includes a number of other modules whose parent is not this module and that do not
      provide tests. These modules provide support infrastructure of various types that is used to execute
      the testsuite.

      aggregator-xxx     Coordinates which test modules execute based on what profiles are enabled.
                         A separate aggregator handles base server, expansion server and preview server testing.
      build-demander-xxx Unless building the production code is disabled, these ensure the production code that builds
                         the various thin and fat server installations has executed before the testsuite modules start
                         trying to test them.
                         A separate build-demander handles base server, expansion server and preview server testing.
      shared             Shared utility code used by tests
      test-feature-pack  Feature pack base server tests can use to provision a server adapted to various test requirements
      t-f-p-preview      Feature pack preview server tests can use to provision a server adapted to various test requirements
      test-product-conf  Provides an artifact used in some manual mode tests.

-->

<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.wildfly</groupId>
        <artifactId>wildfly-parent</artifactId>
        <!--
        Maintain separation between the artifact id and the version to help prevent
        merge conflicts between commits changing the GA and those changing the V.
        -->
        <version>37.0.0.Final-SNAPSHOT</version>
    </parent>

    <artifactId>wildfly-testsuite</artifactId>
    <packaging>pom</packaging>

    <name>WildFly Test Suite: Aggregator</name>


    <!-- Global testsuite system properties defaults. -->

    <properties>
        <!-- Current module's directory. Will automatically pick up sub-module's basedir. -->
        <jbossas.ts.submodule.dir>${basedir}</jbossas.ts.submodule.dir>
        <!-- Integration module's directory. To be overriden in sub-modules. -->
        <jbossas.ts.integ.dir>${basedir}/integration</jbossas.ts.integ.dir>
        <!-- This project's testsuite dir. To be changed for every submodule (until we figure out how to do it automatically). -->
        <jbossas.ts.dir>${basedir}</jbossas.ts.dir>
        <!-- This project's root dir. -->
        <jbossas.project.dir>${jbossas.ts.dir}/..</jbossas.project.dir>

        <!-- Skips profile generation; to be used with running single test with -Dtest=... -->
        <skip.antrun>false</skip.antrun>

        <!-- Used to provide an absolute location for the distribution under test. -->
        <!-- This value is overridden in modules with the correct relative pathname. -->
        <jboss.dist>${project.basedir}/../${wildfly.build.output.dir}</jboss.dist>
        <jboss.home>${jboss.dist}</jboss.home>

        <!-- Used to provide an absolute location for the XSLT scripts. -->
        <!-- This value is overridden in modules with the correct relative pathname. -->
        <xslt.scripts.dir>${jbossas.ts.integ.dir}/src/test/xslt</xslt.scripts.dir>

        <!-- The artifactId of the pom to use as an import scope dependency (a bom) for testsuite modules.
             Child modules or profiles can override this to use a different dependency set,
             for example to test WildFly Preview or to test microprofile.
             Default is the EE dependency set. -->
        <dependency.management.import.artifact>wildfly-standard-ee-bom</dependency.management.import.artifact>
        <dependency.management.import.test.artifact>wildfly-standard-test-bom</dependency.management.import.test.artifact>

        <!-- IP address defaults. -->
        <node0>127.0.0.1</node0>
        <node1>127.0.0.1</node1>
        <mcast>230.0.0.4</mcast> <!-- Default multicast address. -->
        <mcast.ttl>0</mcast.ttl> <!-- Multicast TTL. -->
        <node0.escaped>${node0}</node0.escaped>

        <!-- additional IP address defaults for xsite clustering tests -->
        <node2>127.0.0.1</node2>
        <node3>127.0.0.1</node3>
        <mcast1>230.0.0.5</mcast1>
        <mcast2>230.0.0.6</mcast2>
        <mcast3>230.0.0.7</mcast3>
        <port-offset>0</port-offset>

        <!-- IP stack configs. -->
        <jvm.args.ip>-Djava.net.preferIPv4Stack=true -Djava.net.preferIPv6Addresses=false</jvm.args.ip>
        <jvm.args.ip.server>${jvm.args.ip}
            -Djboss.bind.address=${node0}
            -Djboss.bind.address.unsecure=${node0}
            -Djboss.bind.address.private=${node0}
            -Djboss.bind.address.management=${node0}
            -Djboss.default.multicast.address=${mcast}
            </jvm.args.ip.server>
        <jvm.args.ip.client>${jvm.args.ip}</jvm.args.ip.client>

        <!-- Server arguments. Cannot have a null server argument in ARQ, set a dummy system property -->
        <jboss.args>-Dts.wildfly.version=${project.version}</jboss.args>
        <!-- jboss.args is used in the arquillian.xml files, but wildfly-core DomainLifecycleUtil expects jboss.domain.server.args -->
        <jboss.domain.server.args></jboss.domain.server.args>

        <!-- Additional JVM args, like those for EC2. -->
        <jvm.args.other>-server -Djdk.tracePinnedThreads=full</jvm.args.other>

        <!-- Logging config -->
        <testLogToFile>true</testLogToFile>

        <!-- Timeout ratios. 100 will leave the timeout as it was coded. -->
        <timeout.factor>100</timeout.factor>
        <jvm.args.timeouts>-Dts.timeout.factor=${timeout.factor}</jvm.args.timeouts>

        <!-- Database properties. -->
        <ds.db></ds.db>
        <ds.jdbc.driver></ds.jdbc.driver>
        <ds.jdbc.driver-xa></ds.jdbc.driver-xa>
        <ds.jdbc.driver.version></ds.jdbc.driver.version>
        <ds.jdbc.url></ds.jdbc.url>
        <ds.jdbc.user>test</ds.jdbc.user>
        <ds.jdbc.pass>test</ds.jdbc.pass>
        <ds.jdbc.driver.jar>${ds.db}-jdbc-driver.jar</ds.jdbc.driver.jar>
        <ds.module.path></ds.module.path>
        <ds.isModule>false</ds.isModule>
        <ds.jdbc.driver.target.path>${basedir}/target/wildfly/standalone/deployments</ds.jdbc.driver.target.path>

        <!-- Common surefire properties. -->
        <surefire.memory.args>-Xmx512m</surefire.memory.args>
        <surefire.jpda.args></surefire.jpda.args>
        <as.debug.port>8787</as.debug.port>
        <!-- The JPMS settings needed by the client side of a portion of the testsuite.
             Defaults to ${modular.jdk.args}, i.e. the standard list of recommended
             client side JPMS settings for users of our client-side libraries.
             If particular tests need additional settings to support client-side behavior
             in their test code, then this property should be overridden in as fine-grained
             a location as is practical; no more coarse-grained than the global config of
             the pom for the maven module that includes the test. -->
        <modular.jdk.testsuite.args>${modular.jdk.args}</modular.jdk.testsuite.args>
        <surefire.system.args>${modular.jdk.testsuite.args} -Dorg.jboss.ejb.client.wildfly-testsuite-hack=true ${surefire.memory.args} ${surefire.jpda.args} -Djboss.dist=${jboss.dist} ${surefire.jacoco.args} -Dmaven.repo.local=${settings.localRepository}</surefire.system.args>
        <extra.server.jvm.args />
        <!-- needed for arquillian-byteman-extension -->
        <surefire.byteman.argline>-Djdk.attach.allowAttachSelf=true</surefire.byteman.argline>
        <surefire.byteman.args>-Djboss.modules.system.packages=com.sun.tools.attach,org.jboss.byteman -Djdk.attach.allowAttachSelf=true</surefire.byteman.args>
        <!-- Hook to control forked process timeout via -D. Default value of 0 means no timeout -->
        <surefire.forked.process.timeout>0</surefire.forked.process.timeout>

        <!-- If servers should be killed before the test suite is run-->
        <org.wildfly.test.kill-servers-before-test>false</org.wildfly.test.kill-servers-before-test>
        
        <!-- Don't try to deploy the testsuite modules because they don't build jars -->
        <maven.deploy.skip>true</maven.deploy.skip>

        <!-- used to enable trace logging for test suite runs -->
        <trace>none</trace>

        <!-- Dynamic part of the name of ee-version-specific test source dir that may be added to the build -->
        <additional.ee.test.source>ee10</additional.ee.test.source>

        <!-- properties to enable plugin executions -->
        <ts.bootable-jar-packaging.phase>none</ts.bootable-jar-packaging.phase>

    </properties>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>${project.groupId}</groupId>
                <artifactId>${dependency.management.import.artifact}</artifactId>
                <version>${project.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <dependency>
                <groupId>${ee.maven.groupId}</groupId>
                <artifactId>${dependency.management.import.test.artifact}</artifactId>
                <version>${ee.maven.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <dependency>
            <groupId>jakarta.inject</groupId>
            <artifactId>jakarta.inject-api</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <testResources>
            <testResource>
                <directory>src/test/resources</directory>
            </testResource>
            <testResource>
                <directory>src/test/resources/filtered</directory>
                <filtering>true</filtering>
            </testResource>
            <testResource>
                <directory>src/test/java</directory>
                <excludes>
                    <exclude>**/*.java</exclude>
                </excludes>
            </testResource>
        </testResources>

        <pluginManagement>
            <plugins>
                <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-compiler-plugin</artifactId>
                   <!-- Don't compile src/main/java - nothing to do. -->
                   <executions><execution><id>default-compile</id><phase>none</phase></execution></executions>
               </plugin>

               <!--
                   A build of target/wildfly which is shared by all modules.
                   Modules and bundles are not copied as they are read-only (see surefire props).
               -->
               <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-resources-plugin</artifactId>
                   <executions combine.children="append">
                       <!-- Copy the AS into current_submodule/target/wildfly . This is executed recursively in submodules. -->
                       <execution>
                           <id>ts.copy-wildfly</id>
                           <inherited>true</inherited>
                           <phase>generate-test-resources</phase>
                           <goals><goal>copy-resources</goal></goals>
                           <configuration>
                               <outputDirectory>${basedir}/target/wildfly</outputDirectory>
                               <overwrite>true</overwrite>
                               <resources>
                                   <resource>
                                       <directory>${jboss.home}</directory>
                                       <excludes>
                                           <exclude>bin/client/</exclude>
                                           <exclude>bin/*.jar</exclude>
                                           <exclude>bin/*.sh</exclude>
                                           <exclude>bin/*.bat</exclude>
                                           <exclude>bin/*.ps1</exclude>
                                           <exclude>docs/licenses/</exclude>
                                           <exclude>docs/schema/</exclude>
                                           <exclude>docs/examples/configs/</exclude>
                                           <exclude>modules/</exclude>
                                           <exclude>welcome-content/*.png</exclude>
                                           <exclude>standalone/data</exclude>
                                           <exclude>standalone/log</exclude>
                                           <exclude>standalone/tmp</exclude>
                                       </excludes>
                                   </resource>
                               </resources>
                           </configuration>
                       </execution>
                   </executions>
               </plugin>

               <!-- WFLY-3361 - use external xalan for XML transformations to
               ensure consistent behaviour on all platrforms.-->
               <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-antrun-plugin</artifactId>
                   <dependencies>
                       <dependency>
                           <groupId>xalan</groupId>
                           <artifactId>xalan</artifactId>
                           <version>2.7.3</version>
                       </dependency>
                       <dependency>
                           <groupId>xalan</groupId>
                           <artifactId>serializer</artifactId>
                           <version>2.7.3</version>
                       </dependency>
                   </dependencies>
               </plugin>

                <!--
                   Sets general surefire system properties.
                   These can be overridden by inheriting plugin configurations.
                -->

                <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-surefire-plugin</artifactId>
                   <configuration>
                       <failIfNoTests>false</failIfNoTests>
                       <systemPropertyVariables>
                           <java.util.logging.manager>org.jboss.logmanager.LogManager</java.util.logging.manager>
                           <jboss.dist>${jboss.dist}</jboss.dist>
                           <jboss.home>${basedir}/target/wildfly</jboss.home>
                           <jboss.args>${jboss.args}</jboss.args>
                           <jboss.domain.server.args>${jboss.domain.server.args}</jboss.domain.server.args>
                           <module.path>${jboss.dist}/modules${path.separator}${basedir}/target/modules</module.path>
                           <org.wildfly.test.kill-servers-before-test>${org.wildfly.test.kill-servers-before-test}</org.wildfly.test.kill-servers-before-test>
                       </systemPropertyVariables>
                       <argLine>${surefire.system.args}</argLine>
                       <trimStackTrace>false</trimStackTrace>
                   </configuration>
               </plugin>
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>build-helper-maven-plugin</artifactId>
                    <executions combine-children="append">
                        <!-- If enabled, add a second test source dir for EE-version-specific classes -->
                        <execution>
                            <id>add-ee-test-source</id>
                            <!-- Disabled by default -->
                            <phase>none</phase>
                            <goals>
                                <goal>add-test-source</goal>
                            </goals>
                            <configuration>
                                <sources>
                                    <source>src/test/${additional.ee.test.source}/java</source>
                                </sources>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>

               <!-- Disable default site run. -->
               <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-site-plugin</artifactId>
                   <executions><execution><id>default-site</id><phase>none</phase></execution></executions>
               </plugin>

               <!-- Don't create jars - nothing to do. -->
               <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-jar-plugin</artifactId>
                   <executions><execution><id>default-jar</id><phase>none</phase></execution></executions>
               </plugin>

               <!-- Don't create source jars - nothing to do. -->
               <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-source-plugin</artifactId>
                   <executions><execution><id>attach-sources</id><phase>none</phase></execution></executions>
               </plugin>

               <!-- Don't install - nothing to do. -->
               <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-install-plugin</artifactId>
                   <executions><execution><id>default-install</id><phase>none</phase></execution></executions>
               </plugin>

                <!-- Don't sign - nothing to do. -->
                <plugin>
                    <groupId>org.wildfly</groupId>
                    <artifactId>wildfly-maven-gpg-plugin</artifactId>
                    <executions><execution><id>default</id><phase>none</phase></execution></executions>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>


    <profiles>

        <!--
           Module execution profiles. DO NOT CONFIGURE PLUGIN EXECUTION VIA THESE PROFILES
        -->
        <profile>
            <id>base-server-tests</id>
            <!-- Base server tests run unless -P !preview-server-tests is used -->
            <activation><property><name>!preview-server-tests</name></property></activation>
            <modules>
                <module>build-demander-base</module> <!-- Ensure base server build/dist modules used by tests are built -->
                <module>aggregator-base</module>
                <module>integration</module>
            </modules>
            <dependencies>
                <!-- Include a dependency on the build demander because in concurrent builds the order
                     of items in the 'modules' element doesn't ensure earlier modules are
                     built before later ones. So use a dependency make sure it is executed. -->
                <dependency>
                    <groupId>${ee.maven.groupId}</groupId>
                    <artifactId>wildfly-ts-build-demander-base</artifactId>
                    <version>${ee.maven.version}</version>
                    <type>pom</type>
                </dependency>
            </dependencies>
        </profile>
        <profile>
            <id>expansion-server-tests</id>
            <!-- Expansion server tests run unless -P !preview-server-tests is used -->
            <activation><property><name>!preview-server-tests</name></property></activation>
            <modules>
                <module>build-demander-expansion</module> <!-- Ensure expansion server build/dist modules used by tests are built -->
                <module>aggregator-expansion</module>
                <module>integration</module>
            </modules>
            <dependencies>
                <!-- Include a dependency on the build demander because in concurrent builds the order
                     of items in the 'modules' element doesn't ensure earlier modules are
                     built before later ones. So use a dependency make sure it is executed. -->
                <dependency>
                    <groupId>${full.maven.groupId}</groupId>
                    <artifactId>wildfly-ts-build-demander-expansion</artifactId>
                    <version>${full.maven.version}</version>
                    <type>pom</type>
                </dependency>
            </dependencies>
        </profile>
        <profile>
            <id>preview-server-tests</id>
            <activation><property><name>preview-server-tests</name></property></activation>
            <modules>
                <module>build-demander-preview</module> <!-- Ensure preview server build/dist modules used by tests are built -->
                <module>aggregator-preview</module>
                <module>integration</module>
            </modules>
            <dependencies>
                <!-- Include a dependency on the build demander because in concurrent builds the order
                     of items in the 'modules' element doesn't ensure earlier modules are
                     built before later ones. So use a dependency make sure it is executed. -->
                <dependency>
                    <groupId>${project.groupId}</groupId>
                    <artifactId>wildfly-ts-build-demander-preview</artifactId>
                    <version>${project.version}</version>
                    <type>pom</type>
                </dependency>
            </dependencies>
        </profile>
        <!-- These execute in all feature pack contexts, so declare them here instead
             of repeating this in the aggregator modules -->
        <profile>
            <id>galleon.module.profile</id>
            <activation><property><name>galleon.module</name></property></activation>
            <modules><module>galleon</module></modules>
        </profile>
        <profile>
            <id>galleon_.module.profile</id>
            <activation><property><name>ts.galleon</name></property></activation>
            <modules><module>galleon</module></modules>
        </profile>


        <!--
            Plugin execution configuration profiles. DO NOT ACTIVATE MODULES VIA THESE PROFILES
        -->

        <profile>
            <id>preview.profile</id>
            <activation><property><name>ts.preview</name></property></activation>
            <properties>
                <dependency.management.import.artifact>wildfly-preview-expansion-bom</dependency.management.import.artifact>
                <dependency.management.import.test.artifact>wildfly-preview-test-expansion-bom</dependency.management.import.test.artifact>
                <!-- For WFP, if there are EE-version-specific test sources, uses the ee11 ones -->
                <additional.ee.test.source>ee11</additional.ee.test.source>
            </properties>
        </profile>

        <profile>
            <id>bootablejar.preview.profile</id>
            <activation>
                <property>
                    <name>ts.bootable.preview</name>
                </property>
            </activation>
            <properties>
                <!-- For WFP, if there are EE-version-specific test sources, uses the ee11 ones -->
                <additional.ee.test.source>ee11</additional.ee.test.source>
            </properties>
        </profile>
        <!-- Profile that can be activated in combination with -Dts.layers and -Dts.galleon
             to execute the tests activated by those profiles, but using the wildfly-preview feature pack
             based variant of wildfly-test-galleon-pack.
        -->
        <profile>
            <id>test.feature.pack.preview.profile</id>
            <activation>
                <property>
                    <name>testsuite.ee.galleon.pack.artifactId</name>
                    <value>wildfly-preview-feature-pack</value>
                </property>
            </activation>
            <properties>
                <dependency.management.import.artifact>wildfly-preview-expansion-bom</dependency.management.import.artifact>
                <dependency.management.import.test.artifact>wildfly-preview-test-expansion-bom</dependency.management.import.test.artifact>
                <testsuite.test.feature.pack.artifactId>wildfly-test-feature-pack-preview</testsuite.test.feature.pack.artifactId>
                <!-- For WFP, if there are EE-version-specific test sources, uses the ee11 ones -->
                <additional.ee.test.source>ee11</additional.ee.test.source>
            </properties>
        </profile>

        <!--
          Debugging profiles.
        -->
        <profile>
            <id>jpda.profile</id>
            <activation><property><name>jpda</name></property></activation>
            <properties>
                <surefire.jpda.args>-agentlib:jdwp=transport=dt_socket,address=*:${as.debug.port},server=y,suspend=y</surefire.jpda.args>
            </properties>
        </profile>
        <profile>
            <id>debug.profile</id>
            <activation><property><name>debug</name></property></activation>
            <properties>
                <surefire.jpda.args>-agentlib:jdwp=transport=dt_socket,address=*:${as.debug.port},server=y,suspend=y</surefire.jpda.args>
            </properties>
        </profile>


        <!-- IPv6. Wildfly-2228. -->
        <profile>
            <id>ts.ipv6</id>
            <activation><property><name>ipv6</name></property></activation>
            <properties>
                <jvm.args.ip>-Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</jvm.args.ip>

                <!-- Override IPv4 defaults from the top. -->
                <node0>::1</node0>
                <node1>::1</node1>
                <!-- Allow loopback to multicast -->
                <!-- ip -6 route add table local local ff13::/16 dev lo metric 5 -->
                <mcast>ff13::1</mcast>
                <node0.escaped>[${node0}]</node0.escaped>

                <!-- Override xsite IPv4 defaults from the top.  -->
                <node2>::1</node2>
                <node3>::1</node3>
                <mcast1>ff13::2</mcast1>
                <mcast2>ff13::3</mcast2>
                <mcast3>ff13::4</mcast3>
            </properties>
        </profile>
        <!-- Ugly workaround for MANTRUN-172 :/   See AS7-3993. -->
        <profile>
            <id>ts.ipv6.dummy.node0</id>
            <activation><property><name>node0</name></property></activation>
            <properties> <node0>${node0}</node0> </properties>
        </profile>
        <profile>
            <id>ts.ipv6.dummy.node1</id>
            <activation><property><name>node1</name></property></activation>
            <properties> <node1>${node1}</node1> </properties>
        </profile>
        <profile>
            <id>ts.ipv6.dummy.mcast</id>
            <activation><property><name>mcast</name></property></activation>
            <properties><mcast>${mcast}</mcast></properties>
        </profile>
        <profile>
            <id>ts.ipv6.dummy.node2</id>
            <activation><property><name>node2</name></property></activation>
            <properties> <node2>${node2}</node2> </properties>
        </profile>
        <profile>
            <id>ts.ipv6.dummy.node3</id>
            <activation><property><name>node3</name></property></activation>
            <properties> <node3>${node3}</node3> </properties>
        </profile>
        <profile>
            <id>ts.ipv6.dummy.mcast1</id>
            <activation><property><name>mcast1</name></property></activation>
            <properties><mcast1>${mcast1}</mcast1></properties>
        </profile>
        <profile>
            <id>ts.ipv6.dummy.mcast2</id>
            <activation><property><name>mcast2</name></property></activation>
            <properties><mcast2>${mcast2}</mcast2></properties>
        </profile>
        <profile>
            <id>ts.ipv6.dummy.mcast3</id>
            <activation><property><name>mcast3</name></property></activation>
            <properties><mcast3>${mcast3}</mcast3></properties>
        </profile>

        <!-- Security manager. -->
        <profile>
            <id>ts.security.manager</id>
            <activation>
                <property>
                    <name>security.manager</name>
                </property>
            </activation>
            <properties>
                <jboss.args>-secmgr</jboss.args>
                <jboss.domain.server.args>-secmgr</jboss.domain.server.args>
                <!-- Re-enable the default surefire execution -->
                <surefire.default-test.phase>test</surefire.default-test.phase>
            </properties>
        </profile>

        <!--
          Database config profiles.
          Changing the default database involves:
            * Adding a dependency for the database driver.
            * Changing the server configuration file.
            * Deploying the driver via the server's deployments directory.

          DEFAULT DATASOURCE implementation note:
            There are two ways:
            *  Leaving the default DS as distributed in AS, or
            *  Having a default set of properties and executing DS config even without -Dds=... specified.
            Currently it's the 2nd.
            Changing to 1st would need moving DS transformation from ts.config-as.ip-and-ds to this profile.

          Usage:
             mvn clean install -rf testsuite -Dds=mysql51

          See: https://community.jboss.org/wiki/DataSourceConfigurationInWildfly
        -->

        <profile>
            <id>ds.createModule.profile</id>
            <activation><property><name>ds.createModule</name></property></activation>
            <properties>
                <ds.jdbc.driver.target.path>${basedir}/target/modules/${ds.module.path}/main</ds.jdbc.driver.target.path>
                <ds.isModule>true</ds.isModule>
            </properties>
            <build>
                <plugins>
                     <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>xml-maven-plugin</artifactId>
                        <executions combine.children="append">
                            <!-- Edit template module.xml -->
                            <execution>
                                <id>ts.config-as.db.change-datasource-module</id>
                                <phase>process-test-sources</phase>
                                <goals><goal>transform</goal></goals>
                                <inherited>true</inherited>
                                <configuration>
                                    <transformationSets>
                                        <transformationSet>
                                            <dir      >${basedir}/target/jdbcDrivers</dir>
                                            <outputDir>${basedir}/target/jdbcDrivers</outputDir>
                                            <stylesheet>${xslt.scripts.dir}/changeModule.xsl</stylesheet>
                                            <includes>
                                                <include>module.xml</include>
                                            </includes>
                                            <parameters>
                                                <parameter><name>ds.jdbc.driver.resource</name><value>${ds.jdbc.driver.jar}</value></parameter>
                                                <parameter><name>ds.jdbc.driver.module.path</name><value>${ds.module.path}</value></parameter>
                                            </parameters>
                                        </transformationSet>
                                    </transformationSets>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-resources-plugin</artifactId>
                         <executions combine.children="append">
                            <!-- Copy template module.xml to working directory -->
                            <execution>
                               <id>ts.config-as.db.copy-jdbc-module-template</id>
                               <phase>generate-test-sources</phase>
                               <goals><goal>copy-resources</goal></goals>
                               <inherited>true</inherited>
                               <configuration>
                                  <outputDirectory>${basedir}/target/jdbcDrivers</outputDirectory>
                                     <resources>
                                        <resource>
                                           <directory>${xslt.scripts.dir}</directory>
                                           <filtering>true</filtering>
                                           <includes>
                                              <include>module.xml</include>
                                           </includes>
                                        </resource>
                                     </resources>
                               </configuration>
                            </execution>
                        </executions>
                    </plugin>

                </plugins>
            </build>
        </profile>


        <profile>
            <!--
                Profile used to perform database related changes.
            -->
            <id>ds.profile</id>
            <activation><property><name>ds</name></property></activation>
            <dependencies>
                <dependency>
                    <groupId>jdbcdrivers</groupId>
                    <artifactId>${ds.db}</artifactId>
                    <version>${ds.jdbc.driver.version}</version>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions combine.children="append">
                          <!-- Copy the JDBC driver to target/jdbcDrivers. -->
                            <execution>
                                <id>ts.config-as.db.copy-jdbc-jars</id>
                                <goals><goal>copy</goal></goals>
                                <phase>generate-test-resources</phase>
                                <inherited>true</inherited>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>jdbcdrivers</groupId>
                                            <artifactId>${ds.db}</artifactId>
                                            <version>${ds.jdbc.driver.version}</version>
                                            <destFileName>${ds.jdbc.driver.jar}</destFileName>
                                        </artifactItem>
                                    </artifactItems>
                                    <outputDirectory>${basedir}/target/jdbcDrivers</outputDirectory>
                                    <stripVersion>true</stripVersion>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>xml-maven-plugin</artifactId>
                        <executions combine.children="append">
                            <!-- Replace ExampleDS datasource in server configurations (target/jbossas). -->
                            <execution>
                                <id>ts.config-as.db.change-datasource</id>
                                <phase>process-test-resources</phase>
                                <goals><goal>transform</goal></goals>
                                <inherited>true</inherited>
                                <configuration>
                                    <transformationSets>
                                        <transformationSet>
                                            <dir      >${basedir}/target/jbossas/standalone/configuration</dir>
                                            <outputDir>${basedir}/target/jbossas/standalone/configuration</outputDir>
                                            <stylesheet>${xslt.scripts.dir}/changeDatabase.xsl</stylesheet>
                                            <includes>
                                                <include>standalone*.xml</include>
                                            </includes>
                                            <parameters>
                                                <parameter><name>ds.jdbc.url</name><value>${ds.jdbc.url}</value></parameter>
                                                <parameter><name>ds.jdbc.user</name><value>${ds.jdbc.user}</value></parameter>
                                                <parameter><name>ds.jdbc.pass</name><value>${ds.jdbc.pass}</value></parameter>
                                                <parameter><name>ds.jdbc.driver</name><value>${ds.jdbc.driver-xa}</value></parameter>
                                                <parameter><name>ds.jdbc.driver.jar</name><value>${ds.jdbc.driver.jar}</value></parameter>
                                                <parameter><name>ds.jdbc.driver.module</name><value>${ds.module.path}</value></parameter>
                                                <parameter><name>ds.jdbc.isModule</name><value>${ds.isModule}</value></parameter>
                                            </parameters>
                                        </transformationSet>
                                    </transformationSets>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-resources-plugin</artifactId>
                         <executions combine.children="append">
                            <!-- Copy JDBC driver and module.xml (if ds.createModule) to deploy folder in targed/jbossas/ (or to module folder target/modules/) -->
                            <execution>
                                <id>deploy-database-driver.server</id>
                                <phase>process-test-resources</phase>
                                <goals><goal>copy-resources</goal></goals>
                                <inherited>true</inherited>
                                <configuration>
                                    <outputDirectory>${ds.jdbc.driver.target.path}</outputDirectory>
                                    <overwrite>true</overwrite>
                                    <resources>
                                        <resource>
                                            <directory>${basedir}/target/jdbcDrivers</directory>
                                            <includes>
                                                <include>${ds.db}-jdbc-driver.jar</include>
                                                <include>module.xml</include>
                                            </includes>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                </plugins>
            </build>
        </profile>

        <!-- Database properties profiles. -->

        <!-- H2 - http://www.h2database.com/html/features.html#database_url -->
        <profile>
            <id>h2.profile</id>
            <activation><property><name>ds</name><value>h2</value></property></activation>
            <properties>
                <ds.db>h2</ds.db>
                <ds.jdbc.driver>org.h2.Driver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>org.h2.jdbcx.JdbcDataSource</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE</ds.jdbc.url>
                <ds.jdbc.driver.version>${version.com.h2database}</ds.jdbc.driver.version>
            </properties>
        </profile>
        <profile>  <!-- We need "OR" but Maven's activation system doesn't support any evaluation :/ -->
            <id>h2_.profile</id>
            <activation><property><name>!ds</name></property></activation>
            <properties>
                <ds.db>h2</ds.db>
                <ds.jdbc.driver>org.h2.Driver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>org.h2.jdbcx.JdbcDataSource</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE</ds.jdbc.url>
                <ds.jdbc.driver.version>${version.com.h2database}</ds.jdbc.driver.version>
            </properties>
        </profile>

        <!-- MySQL 5.1 -->
        <profile>
            <id>mysql51.profile</id>
            <activation><property><name>ds</name><value>mysql51</value></property></activation>
            <properties>
                <ds.db>mysql</ds.db>
                <ds.jdbc.driver>com.mysql.jdbc.Driver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>com.mysql.jdbc.jdbc2.optional.MysqlXADataSource</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:mysql://localhost:3306/test</ds.jdbc.url>
                <ds.jdbc.driver.version>5.1.17</ds.jdbc.driver.version>
                <ds.module.path>com/mysql</ds.module.path>
            </properties>
        </profile>

        <!-- DB2 -->
        <profile>
            <id>db2.profile</id>
            <activation><property><name>ds</name><value>db2</value></property></activation>
            <properties>
                <ds.db>db2</ds.db>
                <ds.jdbc.driver>com.ibm.db2.jcc.DB2Driver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>com.ibm.db2.jcc.DB2Driver</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:db2://localhost:60000/test</ds.jdbc.url>
                <ds.jdbc.driver.version>4.11.77</ds.jdbc.driver.version>
            </properties>
        </profile>

        <!-- MS SQL 2005 -->
        <profile>
            <id>mssql2005.profile</id>
            <activation><property><name>ds</name><value>mssql2005</value></property></activation>
            <properties>
                <ds.db>mssql</ds.db>
                <ds.jdbc.driver>com.microsoft.sqlserver.jdbc.SQLServerDriver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>com.microsoft.sqlserver.jdbc.SQLServerDriver</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:sqlserver://localhost:1433;DatabaseName=test</ds.jdbc.url>
                <ds.jdbc.driver.version>3.0.1301.101</ds.jdbc.driver.version>
            </properties>
        </profile>

        <!-- Oracle -->
        <profile>
            <id>oracle11.profile</id>
            <activation><property><name>ds</name><value>oracle11</value></property></activation>
            <properties>
                <ds.db>oracle</ds.db>
                <ds.jdbc.driver>oracle.jdbc.driver.OracleDriver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>oracle.jdbc.driver.OracleDriver</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:oracle:thin:@localhost:1521:test</ds.jdbc.url>
                <ds.jdbc.driver.version>11.2.0.2.0</ds.jdbc.driver.version>
            </properties>
        </profile>

        <!-- PostgreSQL -->
        <profile>
            <id>postgresql.profile</id>
            <activation><property><name>ds</name><value>postgresql</value></property></activation>
            <properties>
                <ds.db>oracle</ds.db>
                <ds.jdbc.driver>org.postgresql.Driver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>org.postgresql.Driver</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:postgresql://localhost:5432/test</ds.jdbc.url>
                <ds.jdbc.driver.version>8.4.702</ds.jdbc.driver.version>
            </properties>
        </profile>

        <!-- Sybase -->
        <profile>
            <id>sybase.profile</id>
            <activation><property><name>ds</name><value>sybase</value></property></activation>
            <properties>
                <ds.db>sybase</ds.db>
                <ds.jdbc.driver>com.sybase.jdbc4.jdbc.SybDriver</ds.jdbc.driver>
                <ds.jdbc.driver-xa>com.sybase.jdbc4.jdbc.SybDriver</ds.jdbc.driver-xa>
                <ds.jdbc.url>jdbc:sybase:Tds:localhost:5000/test</ds.jdbc.url>
                <ds.jdbc.driver.version>26502</ds.jdbc.driver.version>
            </properties>
        </profile>

        <profile>
            <id>test-reporting</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions combine.self="override">

                            <!-- Run the reporting tool. -->
                            <execution>
                                <id>reporting</id>
                                <phase>site</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <inherited>false</inherited>
                                <configuration>
                                    <target>
                                        <ant dir="${basedir}" antfile="${basedir}/tools/reporting/buildReports.xml">
                                            <!-- Defaults.
                                            <property name="reporting.dir" value="${basedir}/tools/reporting"/>
                                            <property name="reports.dest.dir" value="${basedir}/target/reports"/>
                                            <property name="reports.src.mask" value="**/target/surefire-reports/TEST-*.xml"/>
                                            -->
                                            <target name="reports"/>
                                        </ant>
                                    </target>
                                </configuration>
                            </execution>

                            <!-- Help banner. -->
                            <execution>
                                <id>banner</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <inherited>false</inherited>
                                <configuration>
                                    <target>
                                        <loadfile property="help.banner" srcFile="${basedir}/tools/help-banner.txt"/>
                                        <echo>${help.banner}</echo>
                                    </target>
                                </configuration>
                            </execution>

                        </executions>
                        <dependencies>
                            <dependency>
                                <groupId>org.apache.ant</groupId>
                                <artifactId>ant-junit</artifactId>
                                <version>${version.ant.junit}</version>
                            </dependency>
                        </dependencies>
                    </plugin>

                </plugins>

            </build>
        </profile>

        <profile>
            <id>help</id>
            <activation><property><name>ts.help</name></property></activation>
            <build>
                <plugins>
                    <!-- Testsuite debugging info. -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-help-plugin</artifactId>
                        <inherited>true</inherited>
                        <executions>
                            <execution>
                                <id>help.active-profiles</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>active-profiles</goal>
                                </goals>
                                <configuration>
                                    <output>target/help.active-profiles.txt</output>
                                </configuration>
                            </execution>
                            <execution>
                                <id>help.effective-pom</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>effective-pom</goal>
                                </goals>
                                <configuration>
                                    <output>target/help.effective-pom.txt</output>
                                </configuration>
                            </execution>
                            <execution>
                                <id>help.effective-settings</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>effective-settings</goal>
                                </goals>
                                <configuration>
                                    <output>target/help.effective-settings.txt</output>
                                </configuration>
                            </execution>
                            <execution>
                                <id>help.system</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>system</goal>
                                </goals>
                                <configuration>
                                    <output>target/help.system.txt</output>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>properties-maven-plugin</artifactId>
                        <version>1.0.0</version>
                        <executions>
                            <execution>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>write-project-properties</goal>
                                </goals>
                                <configuration>
                                    <outputFile>target/help.properties.txt</outputFile>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>ci-cleanup</id>
            <activation>
                <property>
                    <name>ci-cleanup</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <!-- Clean the server configuration(s) -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-clean-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>clean-test-servers</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>clean</goal>
                                </goals>
                                <configuration>
                                    <failOnError>false</failOnError>
                                    <excludeDefaultDirectories>true</excludeDefaultDirectories>
                                    <filesets>
                                        <fileset>
                                            <directory>target/jbossas</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/wildfly-1</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/wildfly-2</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/wildfly-3</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/wildfly-4</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <!-- Skip target/old-versions which is in testsuite/mixed-domain
                                             1) That's the last test module so cleaning it after its done
                                                doesn't gain anything; nothing else will take advantage of the space
                                             2) On windows jobs on CI we keep seeing stuff like this for hundreds of files
                                                taking many minutes and often causing test runs to time out
                                                [20:10:55][Step 4/5] [WARNING] Failed to delete C:\BuildAgent\work\5768cf3a0bee5b47\full\testsuite\mixed-domain\target\old-versions\jboss-eap-7.0.0\jboss-eap-7.0\modules\system\layers\base\org\wildfly\security\elytron\main\wildfly-elytron-1.0.2.Final-redhat-1.jar
                                        <fileset>
                                            <directory>target/old-versions</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        -->
                                        <fileset>
                                            <directory>target/domains</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-layered</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-admin-only</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-messaging-ha-server1</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-messaging-ha-server2</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-parse-marshal</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-with-remote-outbound-connection</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-with-remote-outbound-connection-tmp</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-multinode-client</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-multinode-client-tmp</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                        <fileset>
                                            <directory>target/jbossas-multinode-server</directory>
                                            <excludes>
                                                <exclude>**/*.log</exclude>
                                            </excludes>
                                        </fileset>
                                    </filesets>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>ts.disable-container-tests-on-windows.profile</id>
            <!--
                There is currently no way to identify hosts on which Docker-based tests should not run apart from an
                OS check. There are CI updates in the pipeline (see https://issues.redhat.com/browse/WFCI-63 and
                https://issues.redhat.com/browse/WFCI-64, for example) that will require this to be modified. Ideally,
                a system property or environment variable can be set to indicate that such tests should not be run. For
                now, we'll have to live with an OS check, which addresses the immediate need.
            -->
            <activation>
                <os>
                    <family>Windows</family>
                </os>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <systemPropertyVariables>
                                <org.arquillian.testcontainers.docker.required.exception>org.junit.AssumptionViolatedException</org.arquillian.testcontainers.docker.required.exception>
                            </systemPropertyVariables>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

    </profiles>
</project>
