<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright The WildFly Authors
  ~ SPDX-License-Identifier: Apache-2.0
  -->

<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.wildfly</groupId>
        <artifactId>wildfly-testsuite</artifactId>
        <!--
        Maintain separation between the artifact id and the version to help prevent
        merge conflicts between commits changing the GA and those changing the V.
        -->
        <version>39.0.1.Final</version>
    </parent>

    <artifactId>wildfly-ts-layers-expansion</artifactId>
    <packaging>jar</packaging>
    <name>WildFly Test Suite: Galleon Layers -- Expansion</name>

    <dependencies>
        <dependency>
            <groupId>org.wildfly.core</groupId>
            <artifactId>wildfly-core-testsuite-shared</artifactId>
            <exclusions>
                <exclusion>
                    <groupId>javax.activation</groupId>
                    <artifactId>activation</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>javax.xml.bind</groupId>
                    <artifactId>jaxb-api</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.wildfly.launcher</groupId>
            <artifactId>wildfly-launcher</artifactId>
        </dependency>
        <dependency>
            <groupId>org.wildfly.security</groupId>
            <artifactId>wildfly-elytron-security-manager</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>wildfly-testsuite-shared</artifactId>
            <exclusions>
                <exclusion>
                    <groupId>*</groupId>
                    <artifactId>*</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.jboss.logmanager</groupId>
            <artifactId>jboss-logmanager</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <properties>
        <layers.install.dir>${project.build.directory}/layers-results</layers.install.dir>
        <layers.delete.installations>true</layers.delete.installations>
        <jbossas.project.dir>${jbossas.ts.dir}/../..</jbossas.project.dir>

        <!-- Where to look for artifacts when provisioning and running. -->
        <maven.repo.local>${settings.localRepository}</maven.repo.local>

        <!-- Props to control what phase plugin executions run in.
             Default is none. Profiles set these to other values to enable executions.
             Provisioning executions using the wildfly-preview-galleon-pack are handled separately from others. -->
        <provisioning.phase>none</provisioning.phase>
        <provisioning.phase.preview.excluded>none</provisioning.phase.preview.excluded> <!-- Use for executions that won't work with WildFly Preview -->
        <provisioning.phase.preview.only>none</provisioning.phase.preview.only> <!-- Use for executions that will only work with WildFly Preview -->
        <!-- Don't run the default surefire execution unless a profile enables it -->
        <surefire.default-test.phase>none</surefire.default-test.phase>
        
        <!-- default configs provisioned with passive+ -->
        <std.default.install.dir>${project.build.directory}/std-configs</std.default.install.dir>

        <!-- This module tests expanded funtionality, so use a bom that includes expansion dependencies -->
		<dependency.management.import.artifact>wildfly-standard-expansion-bom</dependency.management.import.artifact>
        <dependency.management.import.test.artifact>wildfly-standard-test-expansion-bom</dependency.management.import.test.artifact>
    </properties>

    <profiles>
        <profile>
            <id>layers.profile</id>
            <activation>
                <property>
                    <name>ts.layers</name>
                </property>
            </activation>
            <properties>
                <!-- Turn on normal plugin execution by changing the phase props from 'none' -->
                <provisioning.phase>compile</provisioning.phase>
                <provisioning.phase.preview.excluded>compile</provisioning.phase.preview.excluded>
                <surefire.default-test.phase>test</surefire.default-test.phase>
            </properties>
        </profile>

        <!-- Test against wildfly-preview feature pack -->
        <profile>
            <id>preview.profile</id>
            <activation>
                <property>
                    <name>ts.preview</name>
                </property>
            </activation>
            <properties>
                <!-- Turn on normal plugin execution by changing the phase props from 'none'.
                     Note that we leave 'provisioning.phase.preview.excluded' as 'none' -->
                <provisioning.phase>compile</provisioning.phase>
                <provisioning.phase.preview.only>compile</provisioning.phase.preview.only>
                <surefire.default-test.phase>test</surefire.default-test.phase>
                <!-- Use the transformed artifact repo -->
                <maven.repo.local>${settings.localRepository}</maven.repo.local>
            </properties>
        </profile>

        <profile>
            <id>skip-tests-and-provisioning-profile</id>
            <activation>
                <property>
                    <name>skipTests</name>
                    <value>true</value>
                </property>
            </activation>
            <properties>
                <provisioning.phase>none</provisioning.phase>
                <surefire.default-test.phase>none</surefire.default-test.phase>
            </properties>
        </profile>
    </profiles>

            <build>
                <plugins>
                    <plugin>
                        <groupId>org.jboss.galleon</groupId>
                        <artifactId>galleon-maven-plugin</artifactId>
                        <configuration>
                            <record-state>true</record-state>
                            <log-time>${galleon.log.time}</log-time>
                            <offline>${galleon.offline}</offline>
                            <plugin-options>
                                <jboss-maven-dist/>
                                <jboss-fork-embedded>${galleon.fork.embedded}</jboss-fork-embedded>
                                <optional-packages>passive+</optional-packages>
                                <!-- What std WF and WFP provision can differ, and we may exclude some
                                     layers for one which don't exist in the other.
                                     So tell Galleon to ignore this. -->
                                <ignore-not-excluded-layers>true</ignore-not-excluded-layers>
                            </plugin-options>
                        </configuration>
                        <!--
                            Keep the executions that use Galleon layers defined only in the wildfly-galleon-pack
                            grouped together at the end of this executions list
                        -->
                        <executions>
                            <execution>
                                <id>datasources-web-server-observability-provisioning-test</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/datasources-web-server-observability</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>datasources-web-server</layer>
                                                <layer>observability</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>jakarta-data-provisioning-test</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase.preview.only}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/jakarta-data</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>jakarta-data</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>jaxrs-server-observability-provisioning-test</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/jaxrs-server-observability</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>jaxrs-server</layer>
                                                <layer>observability</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>test-standalone-reference-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/test-standalone-reference</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <included-configs>
                                                <config>
                                                    <model>standalone</model>
                                                    <name>standalone.xml</name>
                                                </config>
                                            </included-configs>
                                        </feature-pack>
                                    </feature-packs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>observability-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/observability</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>observability</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>opentelemetry-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/opentelemetry</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>opentelemetry</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <!--
                                Galleon layers defined only in wildfly-galleon-pack
                             -->
                            <execution>
                                <id>microprofile-platform-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-platform</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-platform</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-config-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-config</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-config</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-health-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-health</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-health</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-openapi-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-openapi</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-openapi</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-fault-tolerance-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-fault-tolerance</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-fault-tolerance</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-jwt-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-jwt</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-jwt</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-lra-coordinator-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-lra-coordinator</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-lra-coordinator</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-lra-participant</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-lra-participant</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-lra-participant</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-reactive-messaging-amqp</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-reactive-messaging-amqp</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-reactive-messaging-amqp</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-reactive-messaging-kafka</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-reactive-messaging-kafka</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>microprofile-reactive-messaging-kafka</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-standalone-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-standalone</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>cloud-server</layer>
                                                <layer>h2-default-datasource</layer>
                                                <layer>microprofile-fault-tolerance</layer>
                                                <layer>microprofile-jwt</layer>
                                                <layer>microprofile-openapi</layer>
                                                <layer>undertow-https</layer>
                                                <layer>web-passivation</layer>
                                            </layers>
                                            <excluded-layers>
                                                <layer>micrometer</layer>
                                            </excluded-layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>microprofile-standalone-ha-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/microprofile-standalone-ha</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>cloud-server</layer>
                                                <layer>h2-default-datasource</layer>
                                                <layer>microprofile-fault-tolerance</layer>
                                                <layer>microprofile-jwt</layer>
                                                <layer>microprofile-openapi</layer>
                                                <layer>undertow-https</layer>
                                                <layer>jpa-distributed</layer>
                                                <layer>web-clustering</layer>
                                            </layers>
                                            <excluded-layers>
                                                <layer>jpa</layer>
                                                <layer>micrometer</layer>
                                            </excluded-layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>

                            <execution>
                                <id>mvc-krazo-provisioning</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/mvc-krazo</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${full.maven.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${full.maven.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>mvc-krazo</layer>
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>

                            <!--
                                All layers provisioned all together
                             -->
                            <execution>
                                <id>all-layers-provisioning-full</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase.preview.excluded}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/test-all-layers</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>base-server</layer>
                                                <layer>batch-jberet</layer>
                                                <layer>bean-validation</layer>
                                                <layer>cdi</layer>
                                                <layer>cloud-profile</layer>
                                                <layer>cloud-server</layer>
                                                <layer>core-management</layer>
                                                <layer>core-server</layer>
                                                <layer>core-tools</layer>
                                                <layer>datasources</layer>
                                                <layer>datasources-web-server</layer>
                                                <layer>deployment-scanner</layer>
                                                <layer>discovery</layer>
                                                <layer>ee</layer>
                                                <layer>ee-security</layer>
                                                <layer>ejb</layer>
                                                <layer>ejb-http-invoker</layer>
                                                <layer>ejb-lite</layer>
                                                <layer>ejb-local-cache</layer>
                                                <layer>elytron</layer>
                                                <layer>elytron-oidc-client</layer>
                                                <layer>embedded-activemq</layer>
                                                <layer>hibernate-search</layer>
                                                <layer>h2-datasource</layer>
                                                <layer>h2-default-datasource</layer>
                                                <layer>h2-driver</layer>
                                                <layer>iiop-openjdk</layer>
                                                <layer>infinispan</layer>
                                                <layer>io</layer>
                                                <layer>jaxrs</layer>
                                                <layer>jaxrs-server</layer>
                                                <layer>jdr</layer>
                                                <layer>jgroups-aws</layer>
                                                <layer>jms-activemq</layer>
                                                <layer>jmx</layer>
                                                <layer>jmx-remoting</layer>
                                                <layer>jpa</layer>
                                                <layer>jsf</layer>
                                                <layer>jsonb</layer>
                                                <layer>jsonp</layer>
                                                <layer>logging</layer>
                                                <layer>mail</layer>
                                                <layer>management</layer>
                                                <layer>messaging-activemq</layer>
                                                <layer>micrometer</layer>
                                                <layer>mod_cluster</layer>
                                                <layer>naming</layer>
                                                <layer>observability</layer>
                                                <layer>opentelemetry</layer>
                                                <layer>pojo</layer>
                                                <layer>remoting</layer>
                                                <layer>request-controller</layer>
                                                <layer>resource-adapters</layer>
                                                <layer>sar</layer>
                                                <layer>security-manager</layer>
                                                <layer>singleton-local</layer>
                                                <layer>transactions</layer>
                                                <layer>undertow</layer>
                                                <layer>undertow-https</layer>
                                                <layer>undertow-load-balancer</layer>
                                                <layer>web-passivation</layer>
                                                <layer>web-console</layer>
                                                <layer>web-server</layer>
                                                <layer>webservices</layer>
                                                <!--
                                                    Galleon layers defined only in the wildfly feature-pack
                                                 -->
                                                <layer>microprofile-config</layer>
                                                <layer>microprofile-fault-tolerance</layer>
                                                <layer>microprofile-health</layer>
                                                <layer>microprofile-jwt</layer>
                                                <layer>microprofile-lra-coordinator</layer>
                                                <layer>microprofile-lra-participant</layer>
                                                <layer>microprofile-openapi</layer>
                                                <layer>microprofile-reactive-streams-operators</layer>
                                                <layer>microprofile-reactive-messaging</layer>
                                                <layer>microprofile-reactive-messaging-amqp</layer>
                                                <layer>microprofile-reactive-messaging-kafka</layer>
                                                <layer>microprofile-rest-client</layer>
                                                <layer>microprofile-telemetry</layer>
                                                <layer>microprofile-platform</layer>
                                                <!-- TODO WFLY-19175 uncomment when promoted to community stability.
                                                     This execution runs a standard WF server, so at the OOTB community
                                                     stability. So, provisioning this layer has no effect.
                                                <layer>mvc-krazo</layer>
                                                -->
                                            </layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>

                           <!-- This is an all layers variant excluding jpa and adding jpa-distributed -->
                            <execution>
                                <id>all-layers-distributed-provisioning-full</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase.preview.excluded}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/test-all-layers-jpa-distributed</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>base-server</layer>
                                                <layer>batch-jberet</layer>
                                                <layer>bean-validation</layer>
                                                <layer>cdi</layer>
                                                <layer>cloud-profile</layer>
                                                <layer>cloud-server</layer>
                                                <layer>core-management</layer>
                                                <layer>core-server</layer>
                                                <layer>core-tools</layer>
                                                <layer>datasources</layer>
                                                <layer>datasources-web-server</layer>
                                                <layer>deployment-scanner</layer>
                                                <layer>discovery</layer>
                                                <layer>ee</layer>
                                                <layer>ee-security</layer>
                                                <layer>ejb</layer>
                                                <layer>ejb-dist-cache</layer>
                                                <layer>ejb-http-invoker</layer>
                                                <layer>ejb-lite</layer>
                                                <layer>elytron</layer>
                                                <layer>elytron-oidc-client</layer>
                                                <layer>hibernate-search</layer>
                                                <layer>h2-datasource</layer>
                                                <layer>h2-default-datasource</layer>
                                                <layer>h2-driver</layer>
                                                <layer>iiop-openjdk</layer>
                                                <layer>infinispan</layer>
                                                <layer>io</layer>
                                                <layer>jaxrs</layer>
                                                <layer>jaxrs-server</layer>
                                                <layer>jdr</layer>
                                                <layer>jgroups-aws</layer>
                                                <layer>jms-activemq</layer>
                                                <layer>jmx</layer>
                                                <layer>jmx-remoting</layer>
                                                <layer>jpa-distributed</layer>
                                                <layer>jsf</layer>
                                                <layer>jsonb</layer>
                                                <layer>jsonp</layer>
                                                <layer>logging</layer>
                                                <layer>mail</layer>
                                                <layer>management</layer>
                                                <layer>messaging-activemq</layer>
                                                <layer>micrometer</layer>
                                                <layer>mod_cluster</layer>
                                                <layer>naming</layer>
                                                <layer>observability</layer>
                                                <layer>opentelemetry</layer>
                                                <layer>pojo</layer>
                                                <layer>remote-activemq</layer>
                                                <layer>remoting</layer>
                                                <layer>request-controller</layer>
                                                <layer>resource-adapters</layer>
                                                <layer>sar</layer>
                                                <layer>security-manager</layer>
                                                <layer>singleton-ha</layer>
                                                <layer>transactions</layer>
                                                <layer>undertow</layer>
                                                <layer>undertow-https</layer>
                                                <layer>undertow-load-balancer</layer>
                                                <layer>web-clustering</layer>
                                                <layer>web-console</layer>
                                                <layer>web-server</layer>
                                                <layer>webservices</layer>
                                                <!--
                                                    Galleon layers defined only in the wildfly feature-pack
                                                 -->
                                                <layer>microprofile-config</layer>
                                                <layer>microprofile-fault-tolerance</layer>
                                                <layer>microprofile-health</layer>
                                                <layer>microprofile-lra-coordinator</layer>
                                                <layer>microprofile-lra-participant</layer>
                                                <layer>microprofile-jwt</layer>
                                                <layer>microprofile-openapi</layer>
                                                <layer>microprofile-reactive-streams-operators</layer>
                                                <layer>microprofile-reactive-messaging</layer>
                                                <layer>microprofile-reactive-messaging-amqp</layer>
                                                <layer>microprofile-reactive-messaging-kafka</layer>
                                                <layer>microprofile-telemetry</layer>
                                                <layer>microprofile-platform</layer>
                                                <!-- TODO WFLY-19175 uncomment when promoted to community stability.
                                                     This execution runs a standard WF server, so at the OOTB community
                                                     stability. So, provisioning this layer has no effect.
                                                <layer>mvc-krazo</layer>
                                                -->
                                            </layers>
                                            <excluded-layers>
                                                <layer>jpa</layer>
                                                <layer>ejb-local-cache</layer>
                                            </excluded-layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>all-layers-provisioning-full-preview</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase.preview.only}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/test-all-layers</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>base-server</layer>
                                                <layer>batch-jberet</layer>
                                                <layer>bean-validation</layer>
                                                <layer>cdi</layer>
                                                <layer>cloud-profile</layer>
                                                <layer>cloud-server</layer>
                                                <layer>core-management</layer>
                                                <layer>core-server</layer>
                                                <layer>core-tools</layer>
                                                <layer>datasources</layer>
                                                <layer>datasources-web-server</layer>
                                                <layer>deployment-scanner</layer>
                                                <layer>discovery</layer>
                                                <layer>ee</layer>
                                                <layer>ee-security</layer>
                                                <layer>ejb</layer>
                                                <layer>ejb-http-invoker</layer>
                                                <layer>ejb-lite</layer>
                                                <layer>ejb-local-cache</layer>
                                                <layer>elytron</layer>
                                                <layer>elytron-oidc-client</layer>
                                                <layer>embedded-activemq</layer>
                                                <layer>hibernate-search</layer>
                                                <layer>h2-datasource</layer>
                                                <layer>h2-default-datasource</layer>
                                                <layer>h2-driver</layer>
                                                <layer>health</layer>
                                                <layer>iiop-openjdk</layer>
                                                <layer>infinispan</layer>
                                                <layer>io</layer>
                                                <layer>infinispan</layer>
                                                <layer>jakarta-data</layer>
                                                <layer>jaxrs</layer>
                                                <layer>jaxrs-server</layer>
                                                <layer>jdr</layer>
                                                <layer>jgroups-aws</layer>
                                                <layer>jms-activemq</layer>
                                                <layer>jmx</layer>
                                                <layer>jmx-remoting</layer>
                                                <layer>jpa</layer>
                                                <layer>jsf</layer>
                                                <layer>jsonb</layer>
                                                <layer>jsonp</layer>
                                                <layer>logging</layer>
                                                <layer>mail</layer>
                                                <layer>management</layer>
                                                <layer>messaging-activemq</layer>
                                                <layer>micrometer</layer>
                                                <layer>mod_cluster</layer>
                                                <layer>naming</layer>
                                                <layer>pojo</layer>
                                                <layer>remoting</layer>
                                                <layer>request-controller</layer>
                                                <layer>resource-adapters</layer>
                                                <layer>sar</layer>
                                                <layer>security-manager</layer>
                                                <layer>singleton-local</layer>
                                                <layer>transactions</layer>
                                                <layer>undertow</layer>
                                                <layer>undertow-https</layer>
                                                <layer>undertow-load-balancer</layer>
                                                <layer>web-passivation</layer>
                                                <layer>web-console</layer>
                                                <layer>web-server</layer>
                                                <layer>webservices</layer>
                                                <!--
                                                    Galleon layers defined only in the wildfly feature-pack
                                                 -->
                                                <layer>microprofile-config</layer>
                                                <layer>microprofile-fault-tolerance</layer>
                                                <layer>microprofile-health</layer>
                                                <layer>microprofile-jwt</layer>
                                                <layer>microprofile-lra-coordinator</layer>
                                                <layer>microprofile-lra-participant</layer>
                                                <layer>microprofile-openapi</layer>
                                                <layer>microprofile-reactive-streams-operators</layer>
                                                <layer>microprofile-reactive-messaging</layer>
                                                <layer>microprofile-reactive-messaging-amqp</layer>
                                                <layer>microprofile-reactive-messaging-kafka</layer>
                                                <layer>microprofile-rest-client</layer>
                                                <layer>microprofile-telemetry</layer>
                                                <layer>microprofile-platform</layer>
                                                <layer>mvc-krazo</layer>
                                                <layer>vertx</layer>
                                            </layers>
                                            <excluded-layers>
                                                <layer>jpa-distributed</layer>
                                            </excluded-layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <execution>
                                <id>all-layers-distributed-provisioning-full-preview</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase.preview.only}</phase>
                                <configuration>
                                    <install-dir>${layers.install.dir}/test-all-layers-jpa-distributed</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                        </feature-pack>
                                    </feature-packs>
                                    <configurations>
                                        <config>
                                            <model>standalone</model>
                                            <name>standalone.xml</name>
                                            <layers>
                                                <layer>base-server</layer>
                                                <layer>batch-jberet</layer>
                                                <layer>bean-validation</layer>
                                                <layer>cdi</layer>
                                                <layer>cloud-profile</layer>
                                                <layer>cloud-server</layer>
                                                <layer>core-management</layer>
                                                <layer>core-server</layer>
                                                <layer>core-tools</layer>
                                                <layer>datasources</layer>
                                                <layer>datasources-web-server</layer>
                                                <layer>deployment-scanner</layer>
                                                <layer>discovery</layer>
                                                <layer>ee</layer>
                                                <layer>ee-security</layer>
                                                <layer>ejb</layer>
                                                <layer>ejb-dist-cache</layer>
                                                <layer>ejb-http-invoker</layer>
                                                <layer>ejb-lite</layer>
                                                <layer>elytron</layer>
                                                <layer>hibernate-search</layer>
                                                <layer>h2-datasource</layer>
                                                <layer>h2-default-datasource</layer>
                                                <layer>h2-driver</layer>
                                                <layer>health</layer>
                                                <layer>iiop-openjdk</layer>
                                                <layer>infinispan</layer>
                                                <layer>io</layer>
                                                <layer>jakarta-data</layer>
                                                <layer>jaxrs</layer>
                                                <layer>jaxrs-server</layer>
                                                <layer>jdr</layer>
                                                <layer>jgroups-aws</layer>
                                                <layer>jms-activemq</layer>
                                                <layer>jmx</layer>
                                                <layer>jmx-remoting</layer>
                                                <layer>jpa-distributed</layer>
                                                <layer>jsf</layer>
                                                <layer>jsonb</layer>
                                                <layer>jsonp</layer>
                                                <layer>logging</layer>
                                                <layer>mail</layer>
                                                <layer>management</layer>
                                                <layer>messaging-activemq</layer>
                                                <layer>micrometer</layer>
                                                <layer>mod_cluster</layer>
                                                <layer>naming</layer>
                                                <layer>pojo</layer>
                                                <layer>remote-activemq</layer>
                                                <layer>remoting</layer>
                                                <layer>request-controller</layer>
                                                <layer>resource-adapters</layer>
                                                <layer>sar</layer>
                                                <layer>security-manager</layer>
                                                <layer>singleton-ha</layer>
                                                <layer>transactions</layer>
                                                <layer>undertow</layer>
                                                <layer>undertow-https</layer>
                                                <layer>undertow-load-balancer</layer>
                                                <layer>web-clustering</layer>
                                                <layer>web-console</layer>
                                                <layer>web-server</layer>
                                                <layer>webservices</layer>
                                                <!--
                                                    Galleon layers defined only in the wildfly-galleon-pack
                                                 -->
                                                <layer>microprofile-config</layer>
                                                <layer>microprofile-health</layer>
                                                <layer>microprofile-jwt</layer>
                                                <layer>microprofile-openapi</layer>
                                                <layer>microprofile-telemetry</layer>
                                                <layer>mvc-krazo</layer>
                                                <layer>vertx</layer>
                                            </layers>
                                            <excluded-layers>
                                                <layer>jpa</layer>
                                                <layer>ejb-local-cache</layer>
                                            </excluded-layers>
                                        </config>
                                    </configurations>
                                </configuration>
                            </execution>
                            <!-- Build all the default standard configs with passive+. -->
                            <execution>
                                <id>test-standalone-passive-plus</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${std.default.install.dir}/standalone</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                            <included-configs>
                                                <config>
                                                    <model>standalone</model>
                                                    <name>standalone.xml</name>
                                                </config>
                                            </included-configs>
                                        </feature-pack>
                                    </feature-packs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>test-standalone-ha-passive-plus</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${std.default.install.dir}/standalone-ha</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                            <included-configs>
                                                <config>
                                                    <model>standalone</model>
                                                    <name>standalone-ha.xml</name>
                                                </config>
                                            </included-configs>
                                        </feature-pack>
                                    </feature-packs>
                                    <custom-config>ha-config.xml</custom-config>
                                </configuration>
                            </execution>
                            <execution>
                                <id>test-standalone-full-passive-plus</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${std.default.install.dir}/standalone-full</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                            <included-configs>
                                                <config>
                                                    <model>standalone</model>
                                                    <name>standalone-full.xml</name>
                                                </config>
                                            </included-configs>
                                        </feature-pack>
                                    </feature-packs>
                                    <custom-config>full-config.xml</custom-config>
                                </configuration>
                            </execution>
                            <execution>
                                <id>test-standalone-full-ha-passive-plus</id>
                                <goals>
                                    <goal>provision</goal>
                                </goals>
                                <phase>${provisioning.phase}</phase>
                                <configuration>
                                    <install-dir>${std.default.install.dir}/standalone-full-ha</install-dir>
                                    <feature-packs>
                                        <feature-pack>
                                            <groupId>${testsuite.full.galleon.pack.groupId}</groupId>
                                            <artifactId>${testsuite.full.galleon.pack.artifactId}</artifactId>
                                            <version>${testsuite.full.galleon.pack.version}</version>
                                            <inherit-configs>false</inherit-configs>
                                            <inherit-packages>false</inherit-packages>
                                            <included-configs>
                                                <config>
                                                    <model>standalone</model>
                                                    <name>standalone-full-ha.xml</name>
                                                </config>
                                            </included-configs>
                                        </feature-pack>
                                    </feature-packs>
                                    <custom-config>full-ha-config.xml</custom-config>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <systemPropertyVariables>
                                <!-- maven.local.repo is set in parent pom.xml, system property surefire.system.args -->
                                <layers.install.root>${layers.install.dir}</layers.install.root>
                                <std.default.install.root>${std.default.install.dir}</std.default.install.root>
                                <jbossas.version>${project.parent.version}</jbossas.version>
                                <cleanup.tmp>${cleanup.tmp}</cleanup.tmp>
                                <layers.delete.installations>${layers.delete.installations}</layers.delete.installations>
                                <maven.repo.local>${maven.repo.local}</maven.repo.local>
                            </systemPropertyVariables>
                        </configuration>
                    </plugin>
                </plugins>
            </build>

</project>
